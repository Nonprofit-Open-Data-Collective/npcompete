devtools::document()
library( haven )        # importing data files
library( tidyr )        # data wrangling
library( dplyr )        # data wrangling
library( ggplot2 )      # fancy plots
library( ggthemes )     # fancy plots
library( scales )       # re-scaling numbers
library( stargazer )    # nice tables
library( pander )       # format tables for HTML
library( DT )           # embed datasets in HTML docs
install.packages('haven')
install.packages('tidyr')
install.packages('dplyr')
install.packages('ggplot2')
install.packages('ggthemes')
install.packages('scales')
install.packages('stargazer')
install.packages('pander')
install.packages('DT')
getwd()
library( haven )        # importing data files
library( tidyr )        # data wrangling
library( dplyr )        # data wrangling
library( ggplot2 )      # fancy plots
library( ggthemes )     # fancy plots
library( scales )       # re-scaling numbers
library( stargazer )    # nice tables
library( pander )       # format tables for HTML
library( DT )           # embed datasets in HTML docs
core.2019 <- readRDS( "Data/coreco.core2019pc.csv" )
core.2019 <- read.csv( "Data/coreco.core2019pc.csv" )
View(core.2019)
names( core.2019 ) <- toupper( names( core.2019 ))
source("~/npcompete/R/hhi.R")
core.data <- select( core.2019, EIN, MSA_NECH, NTMAJ12, TOTREV, CONT )
core.data$NTMAJ12[ core.data$NTMAJ12 == "AR" ] <- "Arts"
core.data$NTMAJ12[ core.data$NTMAJ12 == "BH" ] <- "Universities"
core.data$NTMAJ12[ core.data$NTMAJ12 == "ED" ] <- "Education"
core.data$NTMAJ12[ core.data$NTMAJ12 == "EH" ] <- "Hospitals"
core.data$NTMAJ12[ core.data$NTMAJ12 == "EN" ] <- "Environmental"
core.data$NTMAJ12[ core.data$NTMAJ12 == "HE" ] <- "Health"
core.data$NTMAJ12[ core.data$NTMAJ12 == "HU" ] <- "Human Services"
core.data$NTMAJ12[ core.data$NTMAJ12 == "IN" ] <- "International"
core.data$NTMAJ12[ core.data$NTMAJ12 == "MU" ] <- "Mutual Benefit"
core.data$NTMAJ12[ core.data$NTMAJ12 == "PU" ] <- "Public Benefit"
core.data$NTMAJ12[ core.data$NTMAJ12 == "RE" ] <- "Religion"
core.data$NTMAJ12[ core.data$NTMAJ12 == "UN" ] <- "Unknown"
core.data$NTMAJ12 <- factor( core.data$NTMAJ12 )
core.data$TOTREV3 <- core.data$TOTREV
ore.data$TOTREV[ core.data$TOTREV < 0 ] <- 0
core.data$TOTREV[ core.data$TOTREV < 0 ] <- 0
hhi <- function(core.data){
dat.hhi <-
core %>%
group_by( MSA_NECH, NTMAJ12 ) %>%
summarize( hhi= sum( (TOTREV / sum(TOTREV))^2 ),
n=n(),
revenue= sum(TOTREV),
contribution=sum(CONT) )
dat.hhi$hhi[ dat.hhi$hhi > 1 ] <- 1
dat.hhi$revenue[ dat.hhi$revenue < 0 ] <- 0
return (dat.hhi)
}
nhhi <- function(core.data){
dat.nhhi <-
core %>%
group_by( MSA_NECH, NTMAJ12 ) %>%
summarize(
nhhi= sum((((TOTREV / sum(TOTREV))^2) -
(1 / EIN)) / (1 -(1 / EIN))),
n=n(), revenue= sum(TOTREV))
dat.nhhi$nhhi[ dat.nhhi$nhhi > 1 ] <- 1
dat.nhhi$revenue[ dat.nhhi$revenue < 0 ] <- 0
return (dat.nhhi)
}
source('hhi.R')
getwd()
source('R/hhi.R')
dat.hhi <- hhi(core.data)
hhi <- function(core.data){
dat.hhi <-
core.data %>%
group_by( MSA_NECH, NTMAJ12 ) %>%
summarize( hhi= sum( (TOTREV / sum(TOTREV))^2 ),
n=n(),
revenue= sum(TOTREV),
contribution=sum(CONT) )
dat.hhi$hhi[ dat.hhi$hhi > 1 ] <- 1
dat.hhi$revenue[ dat.hhi$revenue < 0 ] <- 0
nhhi <- function(core.data){
dat.nhhi <-
core.data %>%
group_by( MSA_NECH, NTMAJ12 ) %>%
summarize(
nhhi= sum((((TOTREV / sum(TOTREV))^2) -
(1 / EIN)) / (1 -(1 / EIN))),
n=n(), revenue= sum(TOTREV))
dat.nhhi$nhhi[ dat.nhhi$nhhi > 1 ] <- 1
dat.nhhi$revenue[ dat.nhhi$revenue < 0 ] <- 0
return (dat.nhhi)
}
hhi <- function(core.data){
dat.hhi <-
core.data %>%
group_by( MSA_NECH, NTMAJ12 ) %>%
summarize( hhi= sum( (TOTREV / sum(TOTREV))^2 ),
n=n(),
revenue= sum(TOTREV),
contribution=sum(CONT) )
dat.hhi$hhi[ dat.hhi$hhi > 1 ] <- 1
dat.hhi$revenue[ dat.hhi$revenue < 0 ] <- 0
return (dat.hhi)
}
dat.hhi <- hhi(core.data)
source('R/hhi.R')
dat.hhi <- hhi(core.data)
dat.nhhi <- nhhi(core.data)
dat.nhhi <- nhhi(core.data)
dat.nhhi %>%
group_by( NTMAJ12 ) %>%
summarize( n=n(), min=min(nhhi), max=max(nhhi) ) %>%
pander()
clw
clear
source("~/npcompete/R/hhi.R")
